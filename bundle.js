(()=>{"use strict";(async()=>{let e=await async function(){const e=await fetch("https://lernia-sjj-assignments.vercel.app/api/challenges");return(await e.json()).challenges}();document.getElementById("text-filter").addEventListener("keyup",(()=>function(e){let t=document.getElementById("text-filter").value;if(t)return e.filter((e=>e.title.toUpperCase().includes(t.toUpperCase())||e.description.toUpperCase().includes(t.toUpperCase())))}(e))),document.querySelector(".button primary").addEventListener("click",(()=>{!function(e){const t=document.createElement("dialog");t.className="modal",t.id="myModal",document.body.appendChild(t),t.style.display="block";const n=document.createElement("div");n.className="modal-content",t.append(n);const a=document.createElement("h1");a.class="modal1h1",a.id="modal1h1",a.innerHTML='Book room "'+e.title+'" (step 1)',n.append(a);const o=document.createElement("p");o.textContent="What date would you like to come?",o.classList.add("modal-content-text"),n.append(o);const l=document.createElement("input"),c=document.createElement("label");document.createElement("br"),l.name="inpDate",l.id="date",l.type="date",l.name="date",c.textContent="Date",n.append(c),n.append(l);const s=new Date;s.setYear(s.getFullYear()+1),date.max=s.toISOString().split("T")[0];const i=new Date;date.min=i.toISOString().split("T")[0];const d=document.createElement("button");d.innerText="Search available times",d.className="btnSearch btnModal",n.append(d);const m=document.createElement("div");m.className="modal-content",m.id="divstep2",t.append(m);const r=document.createElement("h1");r.class="modal2h1",r.id="modal2h1",m.append(r);const p=document.createElement("input"),u=document.createElement("label");p.name="inpName",p.type="text",u.textContent="Name",m.append(u),m.append(p);const h=document.createElement("input"),E=document.createElement("label");h.name="inpPhone",h.type="text",E.textContent="Phone Number",m.append(E),m.append(h);const y=document.createElement("input"),v=document.createElement("label");y.name="inpEmail",y.type="email",v.textContent="E-mail",m.append(v),m.append(y);const f=document.createElement("select");f.name="timeList",f.id="availableTimeList";const b=document.createElement("label");b.textContent="What time?",m.append(b),m.append(f);const x=document.createElement("select");x.name="participantsList",x.id="availableParticipantsList";const g=document.createElement("label");g.textContent="How many participants?",m.append(g),m.append(x);const C=document.createElement("button");C.innerText="Submit booking",C.className="btnSubmit btnModal",m.append(C);const N=document.createElement("div");N.className="modal-content",N.id="divstep3",t.append(N);const k=document.createElement("h1");k.class="modal3h1",k.textContent="Thank you!",N.append(k);const S=document.createElement("a");function w(){return l.value}N.append(S),S.classList.add("challenges-link"),S.setAttribute("href","#"),S.textContent="Back to challenges",l.className="modal-content-text",p.className="modal-content-text",y.className="modal-content-text",c.className="modal-content-text",u.className="modal-content-text",v.className="modal-content-text",b.className="modal-content-text",g.className="modal-content-text",S.onclick=function(){document.body.removeChild(t)},window.onclick=function(e){e.target==t&&document.body.removeChild(t)},d.onclick=function(){const e=w();let t=new Date;const a=`${t.getUTCFullYear()+1}-${String(t.getUTCMonth()+1).padStart(2,"0")}-${String(t.getUTCDate()).padStart(2,"0")}`;if(""==l.value)alert("Error, no selected date.");else if(Date.parse(l.value)>Date.parse(a))alert("Please select a new date, date over a year in the future");else{async function o(e,t){await fetch("https://lernia-sjj-assignments.vercel.app/api/booking/available-times?challenge="+e+"&date="+t,{method:"GET",mode:"cors",headers:{"Content-Type":"application/json"}}).then((function(e){e.ok&&e.json().then((function(e){!function(e){let t,a;document.getElementById("modal2h1").textContent='Book room "'+h1title+'" (step 2)';for(let n=0;n<e.length;n++)t=document.createElement("option"),t.text=e[n],t.value=e[n],f.add(t);for(let e=minParticipants;e<=maxParticipants;e++)a=document.createElement("option"),a.text=e+" participants",a.value=e,x.add(a);n.style.display="none",m.style.display="flex"}(e.slots)}))}))}o(roomID,e)}},C.onclick=function(e){const t=w(),n=(""==p.value&&alert("Error, no entered participant name."),p.value),a=h.value,o=function(){if(""==y.value)alert("Error, no entered e-mail.");else{if(y.value.match(/^[^]+@[^]+\.[a-z]{2,3}$/))return y.value;alert("Error, the entered email is invalid.")}}(),l=(""==f.value&&alert("Error, no selected time."),f.value),c=(""==x.value&&alert("Error, no selected participants number."),x.value);if(t&&n&&o&&l&&c){async function s(e,t,n,a,o,l,c){const s=await fetch("https://lernia-sjj-assignments.vercel.app/api/booking/reservations",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:parseInt(e),name:t,phone:n,email:a,date:o,time:l,participants:parseInt(c)})}),i=await s.json();console.log(i)}s(roomID,n,a,o,t,l,c),m.style.display="none",N.style.display="flex"}}}(data)}))})()})();