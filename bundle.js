(()=>{"use strict";function e(){document.querySelector(".modal-container").remove()}async function t(e){const t=document.querySelector(".modal-container");t.innerHTML="",t.appendChild(await e)}(async()=>{let n=await async function(){const e=await fetch("https://lernia-sjj-assignments.vercel.app/api/challenges");return(await e.json()).challenges}();document.getElementById("text-filter").addEventListener("keyup",(()=>function(e){let t=document.getElementById("text-filter").value;if(console.log(t),t)return e.filter((e=>e.title.toUpperCase().includes(t.toUpperCase())||e.description.toUpperCase().includes(t.toUpperCase())))}(n))),document.querySelectorAll(".challenge-item button").forEach((n=>{n.addEventListener("click",(a=>{!function(n){const a=document.createElement("div");a.classList.add("modal-container"),document.body.appendChild(a),t(async function(n){const a=document.createElement("form");a.classList.add("modal-content");const o=document.createElement("h1");o.textContent=`Book room ${n.title} (step 1)`,a.appendChild(o);const c=document.createElement("p");c.textContent="What date would you like to come?",a.appendChild(c);const l=document.createElement("label");l.textContent="Date",l.for="input[type=date]",a.appendChild(l);const i=document.createElement("input");i.type="date",i.setAttribute("min",(new Date).toLocaleDateString()),a.appendChild(i);const s=document.createElement("button");return s.type="submit",s.classList.add("button","primary"),s.name="search-times",s.textContent="Search available times",a.appendChild(s),a.addEventListener("submit",(async a=>{a.preventDefault();const o=i.value;if(""===i.value)alert("Please choose a date");else{const a=await async function(e,t){const n=await fetch("https://lernia-sjj-assignments.vercel.app/api/booking/available-times?date="+t+"&challenge="+e);return await n.json()}(n.id,o);t(async function(n,a){const o=document.createElement("form");o.classList.add("modal-content");const c=document.createElement("h1");c.textContent=`Book room ${n.title} (step 2)`,o.appendChild(c);const l=document.createElement("label");l.textContent="Name",l.for="input-name",o.appendChild(l);const i=document.createElement("input");i.type="text",i.classList.add("input-name"),o.appendChild(i);const s=document.createElement("label");s.textContent="E-mail",s.for="input-email",o.appendChild(s);const d=document.createElement("input");d.type="email",d.classList.add("input-email"),o.appendChild(d);const r=document.createElement("label");r.textContent="What time?",s.for="select-time",o.appendChild(r);const m=document.createElement("select");m.classList.add("select-time");const p=document.createElement("option");p.textContent="-- Choose time --",m.appendChild(p),o.appendChild(m);for(let e=0;e<a.slots.length;e++){const t=document.createElement("option");t.textContent=a.slots[e],m.appendChild(t)}const u=document.createElement("label");u.textContent="How many participants?",u.for="select-participants",o.appendChild(u);const h=document.createElement("select");h.classList.add("select-participants");const C=document.createElement("option");C.textContent="-- Select number --",h.appendChild(C),o.appendChild(h);let y=n.maxParticipants-n.minParticipants;for(let e=0;e<y;e++){const t=document.createElement("option");t.textContent=`${n.minParticipants+e} participants`,h.appendChild(t)}const E=document.createElement("button");return E.type="submit",E.classList.add("button","primary"),E.name="submit-booking",E.textContent="Submit booking",o.appendChild(E),o.addEventListener("submit",(async o=>{o.preventDefault();let c=document.querySelector(".input-name").value,l=document.querySelector(".input-email").value,i=document.querySelector(".select-participants").value,s=document.querySelector(".select-time").value,d=a.date,r=n.id,m=i.match(/(\d+)/);i=parseInt(m[0]),""===c||""===l?alert("Please fill in requested fields."):"-- Select number --"===i?alert("Please select participants."):"-- Choose time --"===s?alert("Please choose time."):(await async function(e,t,n,a,o,c){const l=await fetch("https://lernia-sjj-assignments.vercel.app/api/booking/reservations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({challenge:e,name:t,email:n,date:a,time:o,participants:c})}),i=await l.json();console.log(i)}(r,c,l,d,s,i),t(function(){const t=document.createElement("div");t.classList.add("modal-content","center");const n=document.createElement("h1");n.textContent="Thank you!",t.appendChild(n);const a=document.createElement("button");return a.classList.add("button","secondary"),a.textContent="Back to challenges",a.addEventListener("click",e),t.appendChild(a),t}()))})),o}(n,a))}})),a}(n))}(JSON.parse(n.querySelector("input").value))}))}))})()})();